<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <title>Formulario</title>

  <!-- Building blocks -->
  <link rel="stylesheet" href="../style/action_menu.css">
  <link rel="stylesheet" href="../style/buttons.css">
  <link rel="stylesheet" href="../style/confirm.css">
  <link rel="stylesheet" href="../style/edit_mode.css">
  <link rel="stylesheet" href="../style/headers.css">
  <link rel="stylesheet" href="../style/input_areas.css">
  <link rel="stylesheet" href="../style/status.css">
  <link rel="stylesheet" href="../style/switches.css">
  <link rel="stylesheet" href="../style_unstable/drawer.css">
  <link rel="stylesheet" href="../style_unstable/lists.css">
  <link rel="stylesheet" href="../style_unstable/progress_activity.css">
  <link rel="stylesheet" href="../style_unstable/scrolling.css">
  <link rel="stylesheet" href="../style_unstable/seekbars.css">
  <link rel="stylesheet" href="../style_unstable/tabs.css">
  <link rel="stylesheet" href="../style_unstable/toolbars.css">
  <link rel="stylesheet" href="../style_unstable/value_selector.css">

  <!-- Icons -->
  <link rel="stylesheet" href="../icons/styles/action_icons.css">
  <link rel="stylesheet" href="../icons/styles/media_icons.css">
  <link rel="stylesheet" href="../icons/styles/comms_icons.css">
  <link rel="stylesheet" href="../icons/styles/settings_icons.css">

  <!-- Transitions -->
  <link rel="stylesheet" href="../transitions.css">
  
  <!-- Util CSS: some extra tricks -->
  <link rel="stylesheet" href="../util.css">
  <link rel="stylesheet" href="../fonts.css">
<style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    [data-position="right"] {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      transform: translateX(100%);
      -webkit-transform: translateX(100%);
      z-index: 15;
      z-index: 100; /* -> drawer */
    }
    section[role="region"][data-position="right"] {
      position: absolute;
    }
    [data-position="right"].current {
      animation: rightToCurrent 0.4s forwards;
      -webkit-animation: rightToCurrent 0.4s forwards;
    }
    [data-position="right"].right {
      animation: currentToRight 0.4s forwards;
      -webkit-animation: currentToRight 0.4s forwards;
    }
    [data-position="current"].left {
      animation: currentToLeft 0.4s forwards;
      -webkit-animation: currentToLeft 0.4s forwards;
    }
    [data-position="current"].current {
      animation: leftToCurrent 0.4s forwards;
      -webkit-animation: leftToCurrent 0.4s forwards;
    }
    [data-position="back"] {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: -1;
      opacity: 0;
      /* z-index: 100; -> drawer */
    }
    [data-position="back"].fade-in {
      z-index: 120;
      animation: fadeIn 0.2s forwards;
      -webkit-animation: fadeIn 0.2s forwards;
    }
    [data-position="back"].fade-out {
      animation: fadeOut 0.2s forwards;
      -webkit-animation: fadeOut 0.2s forwards;
    }

    [data-position="edit-mode"] {
      position: absolute;
      top: -5rem;
      left: 0;
      right: 0;
      bottom: -7rem;
      z-index: -1;
      opacity: 0;
      transition: all 0.3s ease;
    }
    [data-position="edit-mode"].edit {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 120;
      opacity: 1;
    }

    /* Headers */
    #headers section[role="region"] {
      margin-bottom: 1.5rem;
    }
    #headers section[role="region"]:not(#drawer) {
      display: inline;
    }
    #headers article header:first-child {
      margin-top: 1.5rem;
    }
    #headers section[role="region"] header h2 {
      margin: 0 0 1.5rem 0;
    }

    /* Lists */
    /* to avoid double background effect on press */
    [data-type=list] li>a:active { 
      background-color: transparent;
    }

    /* Drawer */
    section[role="region"]:not(#drawer) {
      transition: none;
      left: 0;
      z-index: 0;
      padding-left: 0;
    }
    section[data-type="sidebar"] + section[role="region"] > header:first-child > button, 
    section[data-type="sidebar"] + section[role="region"] > header:first-child > a {
      background-position: 3.5rem center;
    }

    /* Switches */
    #switches label:last-child {
      margin-left: 2rem;  
    }

    /* Scrolling */
    nav[data-type="scrollbar"] {
      padding-top: 1rem;
    }
    nav[data-type="scrollbar"] p {
      opacity: 1;
    }

    /* Seek bars */
    div[role="slider"] > label.icon {
      background: no-repeat right top;
      background-size: 3rem auto;
    }
    
    /* Tabs */
    #tabs .content {
      padding: 0;
    }
    #tabs .content .content {
      padding: 1.5rem 3rem;
    }

    /* Filters */
    [role="tablist"][data-type="filter"] {
      margin-bottom: 2rem;
    }

    .bottom[role="tablist"][data-type="filter"] {
      bottom: auto;
    }

    /* Device rotation */
    .landscape section[role="region"]#drawer > header:first-child {
      /* Whatever needs to be changed on landscape */
    }

    #fecha {
      position: absolute;
      width: 95%;
      height: 100%;
      margin-left: -6%;
      font-size: 1em;
      padding-left: 5%;
    }

    #dependencia {
      position: absolute;
      width: 100%;
      height: 100%;
      margin-left: -6%;
      border:none;
      background: transparent;
      opacity: 0;
    }

    #option {
      position: absolute;
      opacity: 0.6;
      font-weight: 400;
    }

    #newcomment {
      position: fixed;
      -moz-transform: translateX(100%);
      -moz-transition: -moz-transform 1s;
    }

    #newcomment:target {
      -moz-transform: translateX(0%);
    }
    
    li > h2 {
      padding-left: 5%;
    }
</style>

</head>
<body>

  <!-- Form -->
    <section id="drawer" role="region">
      <header class="fixed">
      <a id="btn-input-areas-back" href="../index.html"><span class="icon icon-back">back</span></a>
      <h1>Reportar problema</h1>
    </header>
      <article class="content scrollable header">
        <header><h1>¡Bienvenido!</h1><h2>Por favor llene los siguientes campos detalladamente para brindarle un mejor servicio.</h2></header>
        <p>
          <ul>
            <li>
              <span class="button icon icon-dialog">
                <span id="option"></span>
                <select name="region.current" id="dependencia">
                  <option>Selecciona dependencia</option>
                  <option>IMSS</option>
                  <option>SEDENA</option>
                  <option>CFE</option>
                  <option>SEP</option>
                  <option>PF</option>
                  <option>PGR</option>
                  <option>Otro</option>
                </select>
              </span>
            </li>
          </ul>
        </p>
        <p>
          <input id="otro" type="text" placeholder="Dependencia">
        </p>
        <p>
        <p>
          <input id="nombre" type="text" placeholder="Nombre(s)">
        </p>

        <p>
          <input id="apellido" type="text" placeholder="Apellidos">
        </p>

        <p>
          <input id="correo" type="email" placeholder="Correo electrónico">
        </p>

        <p>
          <input id="telefono" type="text" placeholder="Teléfono contacto">
        </p>

        <p>
          <textarea id="descripcion" placeholder="Descripción de la situación"></textarea>
        </p>

        <p>
          <ul>
            <li>
              <span class="button icon icon-dialog">
                <input id="fecha" type="date" placeholder="Fecha de incidente"/>
              </span>
            </li>
        </ul>
        </p>

        <section data-type="list">
          <ul>
            <li>
              <aside class="pack-end">
                <label class="pack-checkbox">
                <input type="checkbox" id="reincide">
                <span></span>
              </label>
              </aside>
                <h2>He vivido la misma situación más de una ocasión</h2>
            </li>
          </ul>
        </section>

 <p><a href="#newcomment" id="go"><button class="recommend" >Enviar</button></a></p>

   </article>
    </section>

    <!-- Loading page -->
    <form role="dialog" data-type="confirm" id="newcomment">
      <section>
        <h1><span id="title">Por favor espere</span></h1>
        <h2><span id="subtitle">Estamos generando su reporte</span></h2>
        <p id="resultado"></p>
        <!-- Note: inline style only for demo purposes -->
        <p style="text-align: center;" id="progress"><progress></progress></p>
        <menu id="acept">
          <button class="recommend recommend affirmative full" onclick="newWindow()">OK</button>
        </menu>
      </section>
    </form>


  <script type="text/javascript" defer src="../js/status.js"></script>
  <script type="text/javascript" defer src="../js/seekbars.js"></script>

  <script type="text/javascript" src="../js/jquery-2.0.3.min.js"></script>
  <script type="text/javascript">

    $(document).ready(function(){

      // fix the checked bug.
      // 'solucion pacheca'
      // set to off
      $('#reincide').val('off');
      // when the check is clicked
      $('#reincide').on('click', function(){

        var $this = $(this);
        // get the input value.
        var value = $this.val();

        //change the input value.
        if(value == "on"){
          $this.val('off');
        }else{
          $this.val('on');
        }
      });

      //hide '#otro' input
      $("#otro").hide();
      $("#acept").hide();

      // hide or show the '#otro' input
      $('#dependencia').change(function(){
        //console.log($('#dependencia option:selected').val());
        if( $('#dependencia option:selected').val() == "Otro" ){
          $("#otro").show();
        }else{
          $("#otro").hide();
        }
      });
      
      $('#go').on('click', function(){

        var dependencia = $('#dependencia option:selected').val(); 
        var nombre = $('#nombre').val();
        var apellido = $('#apellido').val();
        var correo = $('#correo').val();
        var descripcion = $('#descripcion').val();
        var telefono   = $('#telefono').val();

        var fecha       = $('#fecha').val();
        var reincide    = $('#reincide').val();

        // se construye la url
        var url = "http://firefox-cndh.herokuapp.com/";
            url = url + dependencia;
            url = url + '/' + nombre;
            url = url + '/' + apellido;
            url = url + '/' + correo;
            url = url + '/' + telefono;
            url = url + '/' + descripcion;
            url = url + '/' + fecha;
            url = url + '/' + reincide;

        console.log(url);

        var connection = navigator.connection || 
                         navigator.mozConnection || 
                         navigator.webkitConnection;


        var online = connection.bandwidth > 0;

        if( online ) {
          var request = new XMLHttpRequest({ mozSystem: true }); // for FFOS
          request.open("get", url, true);
          request.onreadystatechange = function() {

            if (request.readyState == 4) {
              if (request.status == 200 || request.status == 0) {
                
                var data = request.responseText;

                data = JSON.parse(data);

                var fecha_s = data.fecha_s;

                $('#resultado').append('<span> Su Folio es: ' + fecha_s + '</span>');
                $('#title').html('Su reporte ha sido recibido.');
                $('#subtitle').html('');
                $('#progress').hide();
                $('#acept').show();
                //console.log(data);
              }

          if (request.readyState == 4) {
            if (request.status == 200 || request.status == 0) {
              
              var data = request.responseText;
              console.log(url);
              //data = JSON.parse(data);

              //var fecha_s = data.fecha_s;

              //$('#resultado').append('<span> Su Folio es: ' + fecha_s + '</span>');
              $('#resultado').append('<span> Su Folio es: ' + request.responseText + '</span>');
              $('#title').html('Su reporte ha sido recibido.');
              $('#subtitle').html('');
              $('#progress').hide();
              $('#acept').show();
              //console.log(data);

            }
          } // end  .onreadystatechange
          request.send();

        }else{
          $('#resultado').append('<span>Por favor revise su conexión de datos o Wi-Fi</span>');
          $('#subtitle').html('');
          $('#progress').hide();
          $('#acept').show();
        }
        

      });
    });

    function newWindow() {
      location.href="../index.html";
    }

  </script>

  <script type="text/javascript">

    $( "#dependencia" ).change(function(){
      if( $('#dependencia option:selected').val() == "Otro" ){
          $("#otro").show();
        }else{
          $("#otro").hide();
        }
      var str = "";
      $( "select option:selected" ).each(function(){
      str = $( this ).text();
    });
      $( "#option" ).text( str );}).change();
  </script>

</body>
</html>